# Implementation Plan: Todo Web Application

**Branch**: `002-todo-webapp` | **Date**: `2026-01-02` | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/sp.specify` command

## Summary

Transform the Phase 1 console-based Todo application into a full-stack web application. The application will use Next.js 14+ for the frontend with a modern, minimalist UI matching the reference design, FastAPI (Python) for the REST API backend, Neon PostgreSQL for persistent storage, and Better Auth for secure authentication. Key features include user accounts, task CRUD operations with priority and category organization, progress tracking with analytics, and responsive mobile design.

## Technical Context

**Language/Version**:
- Frontend: TypeScript 5.x (via Next.js 14+)
- Backend: Python 3.13+
- Database: PostgreSQL 15+ (via Neon)

**Primary Dependencies**:
- Frontend: Next.js 14, React 18, Tailwind CSS, Better Auth, React Query
- Backend: FastAPI, Pydantic v2, SQLAlchemy 2.0, psycopg2-binary, python-jose
- Database: Neon PostgreSQL with async driver (asyncpg)

**Storage**: Neon PostgreSQL cloud database (serverless, autoscaling)

**Testing**:
- Frontend: Jest + React Testing Library, Playwright (E2E)
- Backend: pytest, httpx (async test client)

**Target Platform**: Web browser (desktop and mobile), deployable to Vercel (frontend) and Railway/Render (backend)

**Project Type**: Full-stack web application with monorepo structure

**Performance Goals**:
- Page load: < 2 seconds (Lighthouse 90+)
- API response: < 500ms p95
- Concurrent users: 100+

**Constraints**:
- API must be RESTful with OpenAPI documentation
- All secrets via environment variables
- Responsive design for mobile (< 768px viewport)
- Single sign-on ready for future OAuth providers

**Scale/Scope**: Individual user accounts with personal task data

## Constitution Check

| Principle | Status | Notes |
|-----------|--------|-------|
| Spec-Driven Development | ✅ PASS | Feature spec created with 8 user stories |
| Clean Architecture | ✅ PASS | Separate frontend/backend with clear boundaries |
| TDD | ✅ PASS | Unit + integration tests planned |
| Python 3.13 Standards | ✅ PASS | Type hints, dataclasses, modern patterns |
| Simplicity First | ✅ PASS | Monorepo structure, minimal external deps |
| CLI-First (Phase 1) | ⏭️ N/A | Phase 2 is web-first |
| In-Memory Only (Phase 1) | ⏭️ N/A | Phase 2 requires persistence |

## Project Structure

### Documentation (this feature)

```text
specs/002-todo-webapp/
├── plan.md              # This file (/sp.plan command output)
├── spec.md              # Feature specification
├── research.md          # UI/UX research from reference design
├── data-model.md        # Database schema and entities
├── quickstart.md        # Development setup guide
├── contracts/           # API specifications
└── tasks.md             # Generated by /sp.tasks (not created by /sp.plan)
```

### Source Code (repository root)

```text
# Monorepo structure for full-stack application
backend/
├── src/
│   ├── __init__.py
│   ├── main.py                    # FastAPI application entry
│   ├── config.py                  # Settings and environment
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py                # User entity
│   │   ├── task.py                # Task entity
│   │   └── database.py            # Base, engine, session
│   ├── schemas/
│   │   ├── __init__.py
│   │   ├── user.py                # Pydantic schemas for User
│   │   ├── task.py                # Pydantic schemas for Task
│   │   └── auth.py                # Auth response schemas
│   ├── api/
│   │   ├── __init__.py
│   │   ├── deps.py                # Dependency injection
│   │   ├── auth.py                # Auth endpoints
│   │   └── tasks.py               # Task CRUD endpoints
│   ├── services/
│   │   ├── __init__.py
│   │   ├── auth_service.py        # Authentication logic
│   │   ├── task_service.py        # Business logic
│   │   └── database.py            # Async DB operations
│   └── utils/
│       ├── __init__.py
│       └── security.py            # Password hashing, JWT
├── tests/
│   ├── __init__.py
│   ├── conftest.py                # Pytest fixtures
│   ├── unit/
│   │   ├── test_models.py
│   │   └── test_schemas.py
│   └── integration/
│       └── test_api.py
├── requirements.txt               # Python dependencies
├── alembic/                       # Database migrations
│   └── versions/
├── pyproject.toml
└── .env.example                   # Environment template

frontend/
├── src/
│   ├── app/
│   │   ├── layout.tsx             # Root layout with providers
│   │   ├── page.tsx               # Landing page
│   │   ├── globals.css            # Global styles
│   │   ├── api/                   # API route handlers (optional)
│   │   ├── (auth)/                # Auth route group
│   │   │   ├── login/page.tsx
│   │   │   └── signup/page.tsx
│   │   └── (dashboard)/           # Protected dashboard group
│   │       ├── layout.tsx         # Dashboard layout with sidebar
│   │       ├── page.tsx           # Main dashboard
│   │       ├── tasks/
│   │       │   ├── page.tsx       # Task list view
│   │       │   └── [id]/page.tsx  # Task detail/edit
│   │       └── categories/
│   │           └── page.tsx       # Category management
│   ├── components/
│   │   ├── ui/                    # Shared UI components
│   │   │   ├── Button.tsx
│   │   │   ├── Input.tsx
│   │   │   ├── Modal.tsx
│   │   │   ├── Badge.tsx
│   │   │   └── Card.tsx
│   │   ├── layout/
│   │   │   ├── Header.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   └── Navigation.tsx
│   │   ├── tasks/
│   │   │   ├── TaskList.tsx
│   │   │   ├── TaskItem.tsx
│   │   │   ├── TaskForm.tsx
│   │   │   └── TaskCheckbox.tsx
│   │   ├── auth/
│   │   │   ├── LoginForm.tsx
│   │   │   └── SignupForm.tsx
│   │   └── stats/
│   │       ├── ProgressWidget.tsx
│   │       └── StatsCard.tsx
│   ├── lib/
│   │   ├── api/                   # API client utilities
│   │   │   ├── client.ts          # Fetch wrapper
│   │   │   ├── endpoints.ts       # Endpoint definitions
│   │   │   └── types.ts           # TypeScript types
│   │   ├── auth/                  # Better Auth integration
│   │   │   ├── client.ts
│   │   │   └── hooks.ts
│   │   └── utils/
│   │       └── helpers.ts
│   ├── hooks/
│   │   ├── useTasks.ts            # React Query hooks
│   │   ├── useAuth.ts
│   │   └── useDebounce.ts
│   ├── stores/                    # State management (optional)
│   │   └── useTaskStore.ts
│   └── types/
│       └── index.ts               # Shared TypeScript types
├── public/
│   └── images/
├── tests/
│   ├── unit/
│   │   ├── components/
│   │   │   └── TaskItem.test.tsx
│   │   └── lib/
│   └── e2e/
│       └── dashboard.spec.ts
├── .eslintrc.json
├── next.config.js
├── package.json
├── tailwind.config.ts
├── tsconfig.json
└── .env.example                    # Environment template

shared/                             # Shared between frontend/backend
├── types/
│   └── index.ts
└── constants/
    └── index.ts
```

**Structure Decision**: Monorepo with `frontend/`, `backend/`, and `shared/` directories at repository root. This provides clear separation of concerns while enabling type sharing and coordinated deployments.

## Complexity Tracking

> No complexity violations at this stage. The structure is intentionally simple for a todo application.

## Database Schema

### Users Table
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_users_email ON users(email);
```

### Categories Table
```sql
CREATE TABLE categories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    name VARCHAR(100) NOT NULL,
    color VARCHAR(7) DEFAULT '#3B82F6',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, name)
);

CREATE INDEX idx_categories_user_id ON categories(user_id);
```

### Tasks Table
```sql
CREATE TABLE tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    category_id UUID REFERENCES categories(id) ON DELETE SET NULL,
    description TEXT NOT NULL,
    priority VARCHAR(10) DEFAULT 'medium' CHECK (priority IN ('high', 'medium', 'low')),
    is_completed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_tasks_user_id ON tasks(user_id);
CREATE INDEX idx_tasks_category_id ON tasks(category_id);
CREATE INDEX idx_tasks_is_completed ON tasks(is_completed);
CREATE INDEX idx_tasks_priority ON tasks(priority);
```

## API Design

### Authentication Endpoints (Better Auth Integration)

| Method | Endpoint | Description | Request Body |
|--------|----------|-------------|--------------|
| POST | /auth/signup | Create account | `{email, password}` |
| POST | /auth/login | Authenticate | `{email, password}` |
| POST | /auth/logout | End session | `{}` |
| POST | /auth/refresh | Refresh token | `{refresh_token}` |
| POST | /auth/forgot-password | Request reset | `{email}` |
| POST | /auth/reset-password | Reset password | `{token, password}` |

### Task Endpoints

| Method | Endpoint | Description | Request Body |
|--------|----------|-------------|--------------|
| GET | /tasks | List all tasks | Query: `?category=&status=` |
| POST | /tasks | Create task | `{description, priority?, category?}` |
| GET | /tasks/:id | Get single task | - |
| PUT | /tasks/:id | Update task | `{description?, priority?, category?}` |
| PATCH | /tasks/:id/toggle | Toggle status | `{is_completed}` |
| DELETE | /tasks/:id | Delete task | - |

### Category Endpoints

| Method | Endpoint | Description | Request Body |
|--------|----------|-------------|--------------|
| GET | /categories | List categories | - |
| POST | /categories | Create category | `{name, color?}` |
| PUT | /categories/:id | Update category | `{name, color?}` |
| DELETE | /categories/:id | Delete category | - |

### Statistics Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | /stats | Get completion stats |
| GET | /stats/weekly | Weekly progress chart |

## Frontend Architecture

### Tech Stack
- **Framework**: Next.js 14 with App Router
- **Styling**: Tailwind CSS (matching reference design)
- **State Management**: React Query (server state) + Zustand (optional local state)
- **Authentication**: Better Auth (client-side)
- **HTTP Client**: Fetch with custom wrapper
- **Forms**: React Hook Form + Zod validation
- **Icons**: Lucide React

### UI Components (matching reference design)
- **Header**: Logo, navigation links, user avatar, logout button
- **Sidebar**: Category list, filter by status, progress summary
- **TaskCard**: Checkbox, description, priority badge, edit/delete actions
- **PriorityBadge**: Color-coded (High=Red, Medium=Amber, Low=Green)
- **TaskForm**: Modal for create/edit with validation
- **ProgressWidget**: "12 tasks completed" style cards
- **StatsCard**: Productivity statistics display

### Pages/Routes
- `/` - Landing page (public)
- `/login` - Login page
- `/signup` - Signup page
- `/dashboard` - Main task list (protected)
- `/dashboard/tasks` - All tasks view
- `/dashboard/categories` - Category management

## Backend Architecture

### Tech Stack
- **Framework**: FastAPI with async support
- **Validation**: Pydantic v2
- **ORM**: SQLAlchemy 2.0 (async)
- **Database**: Neon PostgreSQL (asyncpg driver)
- **Auth**: Better Auth compatible JWT tokens
- **Password Hashing**: bcrypt
- **CORS**: Enabled for frontend origins

### Dependency Injection
- `get_db()`: Async database session
- `get_current_user()`: JWT authentication dependency
- `get_task_service()`: Task business logic

### Error Handling
- `401 Unauthorized`: Invalid or expired token
- `404 Not Found`: Resource doesn't exist
- `422 Validation Error`: Invalid input data
- `500 Internal Server Error`: Unexpected errors

## Authentication Flow

1. **Signup**: User submits email/password → Backend creates user → Returns tokens
2. **Login**: User submits credentials → Backend validates → Returns JWT access + refresh tokens
3. **Authenticated Requests**: Include `Authorization: Bearer <token>` header
4. **Token Refresh**: Access token expires → Use refresh token → Get new access token
5. **Logout**: Blacklist refresh token → Clear client storage

## Deployment Strategy

### Backend (Railway/Render)
- Dockerfile with Python 3.13
- Environment variables: `DATABASE_URL`, `JWT_SECRET`, `ALLOWED_ORIGINS`
- Health check endpoint: `GET /health`
- Automatic restarts on failure

### Frontend (Vercel)
- Next.js preset
- Environment variables: `NEXT_PUBLIC_API_URL`, `BETTER_AUTH_URL`
- Edge runtime for API routes
- Automatic builds on git push

### Database (Neon)
- Serverless PostgreSQL
- Auto-scaling based on usage
- Point-in-time recovery enabled
- Connection pooling via PgBouncer

## Development Workflow

### Prerequisites
- Python 3.13+
- Node.js 20+
- Neon account + database created
- Git

### Setup Commands
```bash
# Backend
cd backend
python -m venv venv
source venv/bin/activate  # or `.\venv\Scripts\activate` on Windows
pip install -r requirements.txt
cp .env.example .env  # Configure environment
alembic upgrade head
uvicorn src.main:app --reload

# Frontend
cd frontend
npm install
cp .env.example .env.local
npm run dev
```

### Testing
```bash
# Backend
cd backend
pytest --cov=src

# Frontend
cd frontend
npm run test
npm run test:e2e
```

## Security Considerations

- **Passwords**: bcrypt hashing with salt rounds
- **JWT**: 15-minute access token, 7-day refresh token
- **CORS**: Whitelist only frontend domain
- **SQL Injection**: Parameterized queries via SQLAlchemy
- **XSS**: React escapes by default, CSP headers
- **Rate Limiting**: Implement per-user rate limits
- **Environment**: No secrets in code, all in `.env`

## Performance Optimizations

- **Database**: Proper indexing, connection pooling
- **API**: Response compression, ETag caching
- **Frontend**: Code splitting, lazy loading, image optimization
- **Queries**: React Query caching, optimistic updates

## Open Questions (Clarified)

1. **Social Login**: Email/Password only for now. Google/GitHub OAuth to be added in a future phase.

2. **Email Service**: Use a mock service or simple log-based email for development. Print reset links to console/logs.

3. **Rate Limits**: Implement basic rate limiting for unauthenticated endpoints (e.g., 10 requests/minute per IP).

4. **Data Import**: Create import script to migrate Phase 1 JSON data (`.todo_tasks.json`) to PostgreSQL database.
